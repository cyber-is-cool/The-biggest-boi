# Created by Matthew Dudzinski on Oct. 23rd, 2023
# For use in Windows NT 1908, 1909, 22H2, 23H2, and beyond.
# Updated infrequently. Commands may damage your system I am not liable for any damages done to machines.


# Task 1: Disable the Guest account (Disable-LocalUser)
Disable-LocalUser -Name "Guest"

# Task 2: Enable the Windows Update Service (Set-Service, Start-Service)
Set-Service -Name "wuauserv" -StartupType "Automatic"
Start-Service -Name "wuauserv"

# Task 3: Disable the Microsoft FTP Service (Set-Service)
Set-Service -Name "ftpsvc" -Status "Stopped"
Set-Service -Name "ftpsvc" -StartupType "Disabled"

# Task 4: Remove unauthorized users from the machine (Remove LocalUser)
#Remove-LocalUser -Name "PLACEHOLDER"
#Remove-LocalUser -Name "PLACEHOLDER"

# Task 5: Add User tonraq (New-LocalUser)
#New-LocalUser -Name "PLACEHOLDER" -Password "S3CureP@ssw0rd2001"

# Task 6 : Remove unauthorized Administrators (Local-GroupMember)
# Remove-LocalGroupMember -Group administrators -Member $iroh


# Task 7: Local Security Policy Changes, etc (secedit)
$exportPath = "C:\security-settings.inf"
secedit /export /cfg $exportPath
$content = Get-Content -Path $exportPath
$content = $content -replace "(?<=MaximumPasswordAge\s*=\s*).*", "90"
$content = $content -replace "(?<=MinimumPasswordAge\s*=\s*).*", "10"
$content = $content -replace "(?<=LockoutDuration\s*=\s*).*", "30"
$content = $content -replace "(?<=LimitBlankPasswordUse\s*=\s*).*", "1"
$content = $content -replace "(?<=MinimumPasswordLength\s*=\s*).*", "4"
$content = $content -replace "(?<=PasswordComplexity\s*=\s*).*", "1"
Set-Content -Path $exportPath -Value $content
secedit /configure /db C:\windows\security\local.sdb /cfg $exportPath /areas SECURITYPOLICY


#Task 8: Registry Changes (reg add)
powershell.exe Disable-WindowsOptionalFeature -Online -FeatureName smb1protocol -norestart
reg add "HKLM\SYSTEM\CurrentControlSet\Services\mrxsmb10" /v Start /t REG_DWORD /d 4 /f
reg add "HKLM\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters" /v SMB1 /t REG_DWORD /d 0 /f
reg add "HKLM\SYSTEM\CurrentControlSet\Services\LanManServer\Parameters" /v RestrictNullSessAccess /t REG_DWORD /d 1 /f
reg add "HKLM\SYSTEM\CurrentControlSet\Control\Lsa" /v RestrictAnonymousSAM /t REG_DWORD /d 1 /f
reg add "HKLM\SYSTEM\CurrentControlSet\Control\Lsa" /v RestrictAnonymous /t REG_DWORD /d 1 /f
reg add "HKLM\SYSTEM\CurrentControlSet\Control\Lsa" /v EveryoneIncludesAnonymous /t REG_DWORD /d 0 /f
reg add "HKLM\SYSTEM\CurrentControlSet\Control\Lsa" /v RestrictRemoteSAM /t REG_SZ /d "O:BAG:BAD:(A;;RC;;;BA)" /f
reg add "HKLM\SYSTEM\CurrentControlSet\Control\Lsa" /v UseMachireneId /t REG_DWORD /d 1 /f
reg add "HKLM\SYSTEM\CurrentControlSet\Control\Lsa" /v LimitBlankPasswordUse /t REG_DWORD /d 1 /f
reg add "HKLM\SYSTEM\CurrentControlSet\Control\LSA\MSV1_0" /v allownullsessionfallback /t REG_DWORD /d 0 /f
reg add "HKLM\SYSTEM\CurrentControlSet\Services\LanmanWorkstation\Parameters" /v EnableSecuritySignature /t REG_DWORD /d 1 /f
reg add "HKLM\SOFTWARE\Policies\Microsoft\Windows NT\Terminal Services" /v fEncryptRPCTraffic /t REG_DWORD /d 1 /f
reg add "HKLM\SOFTWARE\Policies\Microsoft\Windows NT\Terminal Services" /v fDisableCdm /t REG_DWORD /d 1 /f
reg add "HKLM\SOFTWARE\Policies\Microsoft\Windows\Explorer" /v NoAutoplayfornonVolume /t REG_DWORD /d 1 /f
reg add "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\policies\Explorer" /v NoDriveTypeAutoRun /t REG_DWORD /d 255 /f
reg add "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer" /v NoAutorun /t REG_DWORD /d 1 /f
reg add "HKLM\SOFTWARE\Policies\Microsoft\Windows\System" /v EnableSmartScreen /t REG_DWORD /d 1 /f
reg add "HKLM\SOFTWARE\Policies\Microsoft\Windows\System" /v ShellSmartScreenLevel /t REG_SZ /d Block /f
reg add "HKLM\SYSTEM\CurrentControlSet\Services\Netlogon\Parameters" /v SealSecureChannel /t REG_DWORD /d 1 /f
reg add "HKLM\SYSTEM\CurrentControlSet\Services\Netlogon\Parameters" /v SignSecureChannel /t REG_DWORD /d 1 /f
reg add "HKLM\SOFTWARE\Policies\Google\Chrome" /v "AdvancedProtectionAllowed" /t REG_DWORD /d 1 /f
reg add "HKLM\SOFTWARE\Policies\Google\Chrome" /v "AllowCrossOriginAuthPrompt" /t REG_DWORD /d 0 /f
reg add "HKLM\SOFTWARE\Policies\Google\Chrome" /v "AlwaysOpenPdfExternally" /t REG_DWORD /d 1 /f
reg add "HKLM\SOFTWARE\Policies\Google\Chrome" /v "AmbientAuthenticationInPrivateModesEnabled" /t REG_DWORD /d 0 /f
reg add "HKLM\SOFTWARE\Policies\Google\Chrome" /v "AudioCaptureAllowed" /t REG_DWORD /d 0 /f
reg add "HKLM\SOFTWARE\Policies\Google\Chrome" /v "AudioSandboxEnabled" /t REG_DWORD /d 1 /f
reg add "HKLM\SOFTWARE\Policies\Google\Chrome" /v "BlockExternalExtensions" /t REG_DWORD /d 1 /f
reg add "HKLM\SOFTWARE\Policies\Google\Chrome" /v "DnsOverHttpsMode" /t REG_SZ /d on /f
reg add "HKLM\SOFTWARE\Policies\Google\Chrome" /v "SSLVersionMin" /t REG_SZ /d tls1 /f
reg add "HKLM\SOFTWARE\Policies\Google\Chrome" /v "ScreenCaptureAllowed" /t REG_DWORD /d 0 /f
reg add "HKLM\SOFTWARE\Policies\Google\Chrome" /v "SitePerProcess" /t REG_DWORD /d 1 /f
reg add "HKLM\SOFTWARE\Policies\Google\Chrome" /v "TLS13HardeningForLocalAnchorsEnabled" /t REG_DWORD /d 1 /f
reg add "HKLM\SOFTWARE\Policies\Google\Chrome" /v "VideoCaptureAllowed" /t REG_DWORD /d 0 /f


# Task 9: Audit Policy (AuditPol)
Auditpol /set /subcategory:"Security Group Management" /success:enable /failure:enable
Auditpol /set /subcategory:"Process Creation" /success:enable /failure:enable
Auditpol /set /subcategory:"Logoff" /success:enable /failure:disable
Auditpol /set /subcategory:"Logon" /success:enable /failure:enable 
Auditpol /set /subcategory:"Filtering Platform Connection" /success:enable /failure:disable
Auditpol /set /subcategory:"Removable Storage" /success:enable /failure:enable
Auditpol /set /subcategory:"SAM" /success:disable /failure:disable
Auditpol /set /subcategory:"Filtering Platform Policy Change" /success:disable /failure:disable
Auditpol /set /subcategory:"IPsec Driver" /success:enable /failure:enable
Auditpol /set /subcategory:"Security State Change" /success:enable /failure:enable
Auditpol /set /subcategory:"Security System Extension" /success:enable /failure:enable
Auditpol /set /subcategory:"System Integrity" /success:enable /failure:enable
auditpol /set /category:"System","Account Management","Account Logon","Logon/Logoff","Policy Change" /failure:enable /success:enable  
auditpol /set /category:"DS Access","Object Access" /failure:enable

#Task 10: Enable Windows Firewall (Set-NetFirewallProfile)
Set-NetFirewallProfile -Profile Domain, Public, Private -Enabled True

#Task 11: Disable Remote Assistance (Get-ItemProperty)
Get-ItemProperty -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows NT\Terminal Services" -Name "fAllowToGetHelp"
Set-ItemProperty -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows NT\Terminal Services" -Name "fAllowToGetHelp" -Value 0
Get-ItemProperty -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows NT\Terminal Services" -Name "fAllowToGetHelp"

#Task 12: Misc (Set-ItemProperty)
Set-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters" -Name "AutoShareWks" -Value 0
Set-ItemProperty -Path "HKLM:\SYSTEM\CurrentControlSet\Services\LanmanServer\Parameters" -Name "AutoShareServer" -Value 0
Restart-Service -Name 'LanmanServer'

#Task 13: Firewall Configuration (netsh)
netsh Advfirewall set allprofiles state on
netsh advfirewall firewall add rule name="Block appvlp.exe netconns" program="C:\Program Files (x86)\Microsoft Office\root\client\AppVLP.exe" protocol=tcp dir=out enable=yes action=block profile=any
netsh advfirewall firewall add rule name="Block appvlp.exe netconns" program="C:\Program Files\Microsoft Office\root\client\AppVLP.exe" protocol=tcp dir=out enable=yes action=block profile=any
netsh advfirewall firewall add rule name="Block calc.exe netconns" program="%systemroot%\system32\calc.exe" protocol=tcp dir=out enable=yes action=block profile=any
netsh advfirewall firewall add rule name="Block calc.exe netconns" program="%systemroot%\SysWOW64\calc.exe" protocol=tcp dir=out enable=yes action=block profile=any
netsh advfirewall firewall add rule name="Block certutil.exe netconns" program="%systemroot%\system32\certutil.exe" protocol=tcp dir=out enable=yes action=block profile=any
netsh advfirewall firewall add rule name="Block certutil.exe netconns" program="%systemroot%\SysWOW64\certutil.exe" protocol=tcp dir=out enable=yes action=block profile=any
netsh advfirewall firewall add rule name="Block cmstp.exe netconns" program="%systemroot%\system32\cmstp.exe" protocol=tcp dir=out enable=yes action=block profile=any
netsh advfirewall firewall add rule name="Block cmstp.exe netconns" program="%systemroot%\SysWOW64\cmstp.exe" protocol=tcp dir=out enable=yes action=block profile=any
netsh advfirewall firewall add rule name="Block cscript.exe netconns" program="%systemroot%\system32\cscript.exe" protocol=tcp dir=out enable=yes action=block profile=any
netsh advfirewall firewall add rule name="Block cscript.exe netconns" program="%systemroot%\SysWOW64\cscript.exe" protocol=tcp dir=out enable=yes action=block profile=any
netsh advfirewall firewall add rule name="Block esentutl.exe netconns" program="%systemroot%\system32\esentutl.exe" protocol=tcp dir=out enable=yes action=block profile=any
netsh advfirewall firewall add rule name="Block esentutl.exe netconns" program="%systemroot%\SysWOW64\esentutl.exe" protocol=tcp dir=out enable=yes action=block profile=any
netsh advfirewall firewall add rule name="Block expand.exe netconns" program="%systemroot%\system32\expand.exe" protocol=tcp dir=out enable=yes action=block profile=any
netsh advfirewall firewall add rule name="Block expand.exe netconns" program="%systemroot%\SysWOW64\expand.exe" protocol=tcp dir=out enable=yes action=block profile=any
netsh advfirewall firewall add rule name="Block extrac32.exe netconns" program="%systemroot%\system32\extrac32.exe" protocol=tcp dir=out enable=yes action=block profile=any
netsh advfirewall firewall add rule name="Block extrac32.exe netconns" program="%systemroot%\SysWOW64\extrac32.exe" protocol=tcp dir=out enable=yes action=block profile=any
netsh advfirewall firewall add rule name="Block findstr.exe netconns" program="%systemroot%\system32\findstr.exe" protocol=tcp dir=out enable=yes action=block profile=any
netsh advfirewall firewall add rule name="Block findstr.exe netconns" program="%systemroot%\SysWOW64\findstr.exe" protocol=tcp dir=out enable=yes action=block profile=any
netsh advfirewall firewall add rule name="Block hh.exe netconns" program="%systemroot%\system32\hh.exe" protocol=tcp dir=out enable=yes action=block profile=any
netsh advfirewall firewall add rule name="Block hh.exe netconns" program="%systemroot%\SysWOW64\hh.exe" protocol=tcp dir=out enable=yes action=block profile=any
netsh advfirewall firewall add rule name="Block makecab.exe netconns" program="%systemroot%\system32\makecab.exe" protocol=tcp dir=out enable=yes action=block profile=any
netsh advfirewall firewall add rule name="Block makecab.exe netconns" program="%systemroot%\SysWOW64\makecab.exe" protocol=tcp dir=out enable=yes action=block profile=any
netsh advfirewall firewall add rule name="Block mshta.exe netconns" program="%systemroot%\system32\mshta.exe" protocol=tcp dir=out enable=yes action=block profile=any
netsh advfirewall firewall add rule name="Block mshta.exe netconns" program="%systemroot%\SysWOW64\mshta.exe" protocol=tcp dir=out enable=yes action=block profile=any
netsh advfirewall firewall add rule name="Block msiexec.exe netconns" program="%systemroot%\system32\msiexec.exe" protocol=tcp dir=out enable=yes action=block profile=any
netsh advfirewall firewall add rule name="Block msiexec.exe netconns" program="%systemroot%\SysWOW64\msiexec.exe" protocol=tcp dir=out enable=yes action=block profile=any
netsh advfirewall firewall add rule name="Block nltest.exe netconns" program="%systemroot%\system32\nltest.exe" protocol=tcp dir=out enable=yes action=block profile=any
netsh advfirewall firewall add rule name="Block nltest.exe netconns" program="%systemroot%\SysWOW64\nltest.exe" protocol=tcp dir=out enable=yes action=block profile=any
netsh advfirewall firewall add rule name="Block Notepad.exe netconns" program="%systemroot%\system32\notepad.exe" protocol=tcp dir=out enable=yes action=block profile=any
netsh advfirewall firewall add rule name="Block Notepad.exe netconns" program="%systemroot%\SysWOW64\notepad.exe" protocol=tcp dir=out enable=yes action=block profile=any
netsh advfirewall firewall add rule name="Block odbcconf.exe netconns" program="%systemroot%\system32\odbcconf.exe" protocol=tcp dir=out enable=yes action=block profile=any
netsh advfirewall firewall add rule name="Block odbcconf.exe netconns" program="%systemroot%\SysWOW64\odbcconf.exe" protocol=tcp dir=out enable=yes action=block profile=any
netsh advfirewall firewall add rule name="Block pcalua.exe netconns" program="%systemroot%\system32\pcalua.exe" protocol=tcp dir=out enable=yes action=block profile=any
netsh advfirewall firewall add rule name="Block pcalua.exe netconns" program="%systemroot%\SysWOW64\pcalua.exe" protocol=tcp dir=out enable=yes action=block profile=any
netsh advfirewall firewall add rule name="Block regasm.exe netconns" program="%systemroot%\system32\regasm.exe" protocol=tcp dir=out enable=yes action=block profile=any
netsh advfirewall firewall add rule name="Block regasm.exe netconns" program="%systemroot%\SysWOW64\regasm.exe" protocol=tcp dir=out enable=yes action=block profile=any
netsh advfirewall firewall add rule name="Block regsvr32.exe netconns" program="%systemroot%\system32\regsvr32.exe" protocol=tcp dir=out enable=yes action=block profile=any
netsh advfirewall firewall add rule name="Block regsvr32.exe netconns" program="%systemroot%\SysWOW64\regsvr32.exe" protocol=tcp dir=out enable=yes action=block profile=any
netsh advfirewall firewall add rule name="Block replace.exe netconns" program="%systemroot%\system32\replace.exe" protocol=tcp dir=out enable=yes action=block profile=any
netsh advfirewall firewall add rule name="Block replace.exe netconns" program="%systemroot%\SysWOW64\replace.exe" protocol=tcp dir=out enable=yes action=block profile=any
netsh advfirewall firewall add rule name="Block rpcping.exe netconns" program="%systemroot%\SysWOW64\rpcping.exe" protocol=tcp dir=out enable=yes action=block profile=any
netsh advfirewall firewall add rule name="Block rundll32.exe netconns" program="%systemroot%\system32\rundll32.exe" protocol=tcp dir=out enable=yes action=block profile=any
netsh advfirewall firewall add rule name="Block rundll32.exe netconns" program="%systemroot%\SysWOW64\rundll32.exe" protocol=tcp dir=out enable=yes action=block profile=any
netsh advfirewall firewall add rule name="Block runscripthelper.exe netconns" program="%systemroot%\system32\runscripthelper.exe" protocol=tcp dir=out enable=yes action=block profile=any
netsh advfirewall firewall add rule name="Block runscripthelper.exe netconns" program="%systemroot%\SysWOW64\runscripthelper.exe" protocol=tcp dir=out enable=yes action=block profile=any
netsh advfirewall firewall add rule name="Block scriptrunner.exe netconns" program="%systemroot%\system32\scriptrunner.exe" protocol=tcp dir=out enable=yes action=block profile=any
netsh advfirewall firewall add rule name="Block scriptrunner.exe netconns" program="%systemroot%\SysWOW64\scriptrunner.exe" protocol=tcp dir=out enable=yes action=block profile=any
netsh advfirewall firewall add rule name="Block SyncAppvPublishingServer.exe netconns" program="%systemroot%\system32\SyncAppvPublishingServer.exe" protocol=tcp dir=out enable=yes action=block profile=any
netsh advfirewall firewall add rule name="Block SyncAppvPublishingServer.exe netconns" program="%systemroot%\SysWOW64\SyncAppvPublishingServer.exe" protocol=tcp dir=out enable=yes action=block profile=any
netsh advfirewall firewall add rule name="Block wmic.exe netconns" program="%systemroot%\system32\wbem\wmic.exe" protocol=tcp dir=out enable=yes action=block profile=any
netsh advfirewall firewall add rule name="Block wmic.exe netconns" program="%systemroot%\SysWOW64\wbem\wmic.exe" protocol=tcp dir=out enable=yes action=block profile=any
netsh advfirewall firewall add rule name="Block wscript.exe netconns" program="%systemroot%\system32\wscript.exe" protocol=tcp dir=out enable=yes action=block profile=any
netsh advfirewall firewall add rule name="Block wscript.exe netconns" program="%systemroot%\SysWOW64\wscript.exe" protocol=tcp dir=out enable=yes action=block profile=any
netsh Advfirewall set allprofiles state on

# Task 14: Updates (Windows Update)
Install-Module PSWindowsUpdate
Add-WUServiceManager -MicrosoftUpdate
Install-WindowsUpdate -MicrosoftUpdate -AcceptAll -AutoReboot | Out-File "C:\($env.computername-Get-Date -f yyyy-MM-dd)-MSUpdates.log" -Force

@echo off
echo Updating firewall policies... 
::Firewall rules in registry 
reg add "HKLM\SOFTWARE\Policies\Microsoft\Windows Defender" /v DisableAntiSpyware /t REG_DWORD /d 0 /f
echo Firewall policies have been updated. 

cmd /k

@echo off
echo Updating automatic update policies...
::Windows automatic updates
reg add HKLM\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate\AU /v AutoInstallMinorUpdates /t REG_DWORD /d 1 /f
reg add HKLM\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate\AU /v NoAutoUpdate /t REG_DWORD /d 0 /f & ::Enable automatic updates
reg add HKLM\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate\AU /v AUOptions /t REG_DWORD /d 4 /f & ::Automatic download and scheduled installation
reg add "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WindowsUpdate\Auto Update" /v AUOptions /t REG_DWORD /d 4 /f & ::Automatic download and scheduled installation
reg add HKLM\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate /v DisableWindowsUpdateAccess /t REG_DWORD /d 0 /f
reg add HKLM\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate /v ElevateNonAdmins /t REG_DWORD /d 0 /f
reg add HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer /v NoWindowsUpdate /t REG_DWORD /d 0 /f
reg add "HKLM\SYSTEM\Internet Communication Management\Internet Communication" /v DisableWindowsUpdateAccess /t REG_DWORD /d 0 /f
reg add HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\WindowsUpdate /v DisableWindowsUpdateAccess /t REG_DWORD /d 0 /f
echo Automatic update policies have been updated. 

cmd /k

@echo off
echo Checking if script contains administrative rights...
net sessions
if %errorlevel%==0 (
echo Success!
) else (
echo No admin, please run with administrative rights...
pause
exit
)
:MENU
echo Choose an option:
echo 1. Automation
echo 2. List Processes
echo 3. Update Password Policies
echo 4. Find Files
echo 5. Disable Remote Desktop
echo 6. Enable Auto-Update
echo 7. Disable Weak Services 
echo 8. System Integrity Scan (uses sfc.exe)
echo 9. Powershell rootkit detection (downloads from web)

CHOICE /C 123456789 /M "Make your selection:"
if ERRORLEVEL 9 goto Nine
if ERRORLEVEL 8 goto Eight
if ERRORLEVEL 7 goto Seven
if ERRORLEVEL 6 goto Six
if ERRORLEVEL 5 goto Five
if ERRORLEVEL 4 goto Four
if ERRORLEVEL 3 goto Three
if ERRORLEVEL 2 goto Two
if ERRORLEVEL 1 goto One
:One
:: Turns on UAC
reg ADD HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System /v EnableLUA /t REG_DWORD /d 1 /f
:: Turns off RDP
reg add "HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /t REG_DWORD /d 1 /f
reg add "HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" /v UserAuthentication /t REG_DWORD /d 0 /f

:: Failsafe
if %errorlevel%==1 netsh advfirewall firewall set service type = remotedesktop mode = disable
:: Windows automatic updates
reg add "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WindowsUpdate\Auto Update" /v AUOptions /t REG_DWORD /d 3 /f


echo Cleaning out the DNS cache...
ipconfig /flushdns
echo Writing over the hosts file...
attrib -r -s C:\WINDOWS\system32\drivers\etc\hosts
echo > C:\Windows\System32\drivers\etc\hosts
if %errorlevel%==1 echo There was an error in writing to the hosts file (not running this as Admin probably)
:: Services
echo Showing you the services...
net start
echo Now writing services to a file and searching for vulnerable services...
net start > servicesstarted.txt
echo This is only common services, not nessecarily going to catch 100%
:: looks to see if remote registry is on
net start | findstr Remote Registry
if %errorlevel%==0 (
	echo Remote Registry is running!
	echo Attempting to stop...
	net stop RemoteRegistry
	sc config RemoteRegistry start=disabled
	if %errorlevel%==1 echo Stop failed... sorry...
) else ( 
	echo Remote Registry is already indicating stopped.
)
:: Remove all saved credentials
cmdkey.exe /list > "%TEMP%\List.txt"
findstr.exe Target "%TEMP%\List.txt" > "%TEMP%\tokensonly.txt"
FOR /F "tokens=1,2 delims= " %%G IN (%TEMP%\tokensonly.txt) DO cmdkey.exe /delete:%%H
del "%TEMP%\*.*" /s /f /q
set SRVC_LIST=(RemoteAccess Telephony tlntsvr p2pimsvc simptcp fax msftpsvc)
	for %%i in %HITHERE% do net stop %%i
	for %%i in %HITHERE% sc config %%i start= disabled
netsh advfirewall firewall set rule name="Remote Assistance (DCOM-In)" new enable=no >NUL
netsh advfirewall firewall set rule name="Remote Assistance (PNRP-In)" new enable=no >NUL
netsh advfirewall firewall set rule name="Remote Assistance (RA Server TCP-In)" new enable=no >NUL
netsh advfirewall firewall set rule name="Remote Assistance (SSDP TCP-In)" new enable=no >NUL
netsh advfirewall firewall set rule name="Remote Assistance (SSDP UDP-In)" new enable=no >NUL
netsh advfirewall firewall set rule name="Remote Assistance (TCP-In)" new enable=no >NUL
netsh advfirewall firewall set rule name="Telnet Server" new enable=no >NUL
netsh advfirewall firewall set rule name="netcat" new enable=no >NUL
dism /online /disable-feature /featurename:IIS-WebServerRole >NUL
dism /online /disable-feature /featurename:IIS-WebServer >NUL
dism /online /disable-feature /featurename:IIS-CommonHttpFeatures >NUL
dism /online /disable-feature /featurename:IIS-HttpErrors >NUL
dism /online /disable-feature /featurename:IIS-HttpRedirect >NUL
dism /online /disable-feature /featurename:IIS-ApplicationDevelopment >NUL
dism /online /disable-feature /featurename:IIS-NetFxExtensibility >NUL
dism /online /disable-feature /featurename:IIS-NetFxExtensibility45 >NUL
dism /online /disable-feature /featurename:IIS-HealthAndDiagnostics >NUL
dism /online /disable-feature /featurename:IIS-HttpLogging >NUL
dism /online /disable-feature /featurename:IIS-LoggingLibraries >NUL
dism /online /disable-feature /featurename:IIS-RequestMonitor >NUL
dism /online /disable-feature /featurename:IIS-HttpTracing >NUL
dism /online /disable-feature /featurename:IIS-Security >NUL
dism /online /disable-feature /featurename:IIS-URLAuthorization >NUL
dism /online /disable-feature /featurename:IIS-RequestFiltering >NUL
dism /online /disable-feature /featurename:IIS-IPSecurity >NUL
dism /online /disable-feature /featurename:IIS-Performance >NUL
dism /online /disable-feature /featurename:IIS-HttpCompressionDynamic >NUL
dism /online /disable-feature /featurename:IIS-WebServerManagementTools >NUL
dism /online /disable-feature /featurename:IIS-ManagementScriptingTools >NUL
dism /online /disable-feature /featurename:IIS-IIS6ManagementCompatibility >NUL
dism /online /disable-feature /featurename:IIS-Metabase >NUL
dism /online /disable-feature /featurename:IIS-HostableWebCore >NUL
dism /online /disable-feature /featurename:IIS-StaticContent >NUL
dism /online /disable-feature /featurename:IIS-DefaultDocument >NUL
dism /online /disable-feature /featurename:IIS-DirectoryBrowsing >NUL
dism /online /disable-feature /featurename:IIS-WebDAV >NUL
dism /online /disable-feature /featurename:IIS-WebSockets >NUL
dism /online /disable-feature /featurename:IIS-ApplicationInit >NUL
dism /online /disable-feature /featurename:IIS-ASPNET >NUL
dism /online /disable-feature /featurename:IIS-ASPNET45 >NUL
dism /online /disable-feature /featurename:IIS-ASP >NUL
dism /online /disable-feature /featurename:IIS-CGI >NUL
dism /online /disable-feature /featurename:IIS-ISAPIExtensions >NUL
dism /online /disable-feature /featurename:IIS-ISAPIFilter >NUL
dism /online /disable-feature /featurename:IIS-ServerSideIncludes >NUL
dism /online /disable-feature /featurename:IIS-CustomLogging >NUL
dism /online /disable-feature /featurename:IIS-BasicAuthentication >NUL
dism /online /disable-feature /featurename:IIS-HttpCompressionStatic >NUL
dism /online /disable-feature /featurename:IIS-ManagementConsole >NUL
dism /online /disable-feature /featurename:IIS-ManagementService >NUL
dism /online /disable-feature /featurename:IIS-WMICompatibility >NUL
dism /online /disable-feature /featurename:IIS-LegacyScripts >NUL
dism /online /disable-feature /featurename:IIS-LegacySnapIn >NUL
dism /online /disable-feature /featurename:IIS-FTPServer >NUL
dism /online /disable-feature /featurename:IIS-FTPSvc >NUL
dism /online /disable-feature /featurename:IIS-FTPExtensibility >NUL
dism /online /disable-feature /featurename:TFTP >NUL
dism /online /disable-feature /featurename:TelnetClient >NUL
dism /online /disable-feature /featurename:TelnetServer >NUL
reg ADD "HKCU\Software\Microsoft\Internet Explorer\Main" /v DoNotTrack /t REG_DWORD /d 1 /f
reg ADD "HKCU\Software\Microsoft\Internet Explorer\Download" /v RunInvalidSignatures /t REG_DWORD /d 1 /f
reg ADD "HKCU\Software\Microsoft\Internet Explorer\Main\FeatureControl\FEATURE_LOCALMACHINE_LOCKDOWN\Settings" /v LOCALMACHINE_CD_UNLOCK /t REG_DWORD /d 1 /t
reg ADD "HKCU\Software\Microsoft\Windows\CurrentVersion\Internet Settings" /v WarnonBadCertRecving /t REG_DWORD /d /1 /f
reg ADD "HKCU\Software\Microsoft\Windows\CurrentVersion\Internet Settings" /v WarnOnPostRedirect /t REG_DWORD /d 1 /f
reg ADD "HKCU\Software\Microsoft\Windows\CurrentVersion\Internet Settings" /v WarnonZoneCrossing /t REG_DWORD /d 1 /f
reg ADD "HKCU\Software\Microsoft\Windows\CurrentVersion\Internet Settings" /v DisablePasswordCaching /t REG_DWORD /d 1 /f 
reg ADD HKCU\SYSTEM\CurrentControlSet\Services\CDROM /v AutoRun /t REG_DWORD /d 1 /f
reg ADD HKLM\SYSTEM\CurrentControlSet\Control\CrashControl /v CrashDumpEnabled /t REG_DWORD /d 0 /f
:: Common Policies
:: Restrict CD ROM drive
reg ADD "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon" /v AllocateCDRoms /t REG_DWORD /d 1 /f
:: Automatic Admin logon
reg ADD "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon" /v AutoAdminLogon /t REG_DWORD /d 0 /f
:: Logo message text
reg ADD "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon" /v LegalNoticeText /t REG_SZ /d "Unauthorized access is prohibited. Violators will be prosecuted to the fullest extent of the law."
:: Logon message title bar
reg ADD "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon" /v LegalNoticeCaption /t REG_SZ /d "Unauthorized access is prohibited."
:: Wipe page file from shutdown
reg ADD "HKLM\SYSTEM\CurrentControlSet\Control\Session Manager\Memory Management" /v ClearPageFileAtShutdown /t REG_DWORD /d 1 /f
:: LOL this is a key? Disallow remote access to floppie disks
reg ADD "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon" /v AllocateFloppies /t REG_DWORD /d 1 /f
:: Prevent print driver installs 
reg ADD "HKLM\SYSTEM\CurrentControlSet\Control\Print\Providers\LanMan Print Services\Servers" /v AddPrinterDrivers /t REG_DWORD /d 1 /f
:: Limit local account use of blank passwords to console
reg ADD "HKLM\SYSTEM\CurrentControlSet\Control\Lsa" /v LimitBlankPasswordUse /t REG_DWORD /d 1 /f
:: Auditing access of Global System Objects
reg ADD "HKLM\SYSTEM\CurrentControlSet\Control\Lsa" /v auditbaseobjects /t REG_DWORD /d 1 /f
:: Auditing Backup and Restore
reg ADD "HKLM\SYSTEM\CurrentControlSet\Control\Lsa" /v fullprivilegeauditing /t REG_DWORD /d 1 /f
:: Do not display last user on logon
reg ADD HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System /v dontdisplaylastusername /t REG_DWORD /d 1 /f
:: UAC setting (Prompt on Secure Desktop)
reg ADD HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System /v PromptOnSecureDesktop /t REG_DWORD /d 1 /f
:: Enable Installer Detection
reg ADD HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System /v EnableInstallerDetection /t REG_DWORD /d 1 /f
:: Undock without logon
reg ADD HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System /v undockwithoutlogon /t REG_DWORD /d 0 /f
:: Maximum Machine Password Age
reg ADD HKLM\SYSTEM\CurrentControlSet\services\Netlogon\Parameters /v MaximumPasswordAge /t REG_DWORD /d 15 /f
:: Disable machine account password changes
reg ADD HKLM\SYSTEM\CurrentControlSet\services\Netlogon\Parameters /v DisablePasswordChange /t REG_DWORD /d 1 /f
:: Require Strong Session Key
reg ADD HKLM\SYSTEM\CurrentControlSet\services\Netlogon\Parameters /v RequireStrongKey /t REG_DWORD /d 1 /f
:: Require Sign/Seal
reg ADD HKLM\SYSTEM\CurrentControlSet\services\Netlogon\Parameters /v RequireSignOrSeal /t REG_DWORD /d 1 /f
:: Sign Channel
reg ADD HKLM\SYSTEM\CurrentControlSet\services\Netlogon\Parameters /v SignSecureChannel /t REG_DWORD /d 1 /f
:: Seal Channel
reg ADD HKLM\SYSTEM\CurrentControlSet\services\Netlogon\Parameters /v SealSecureChannel /t REG_DWORD /d 1 /f
:: Don't disable CTRL+ALT+DEL even though it serves no purpose
reg ADD HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System /v DisableCAD /t REG_DWORD /d 0 /f 
:: Restrict Anonymous Enumeration #1
reg ADD HKLM\SYSTEM\CurrentControlSet\Control\Lsa /v restrictanonymous /t REG_DWORD /d 1 /f 
:: Restrict Anonymous Enumeration #2
reg ADD HKLM\SYSTEM\CurrentControlSet\Control\Lsa /v restrictanonymoussam /t REG_DWORD /d 1 /f 
:: Idle Time Limit - 45 mins
reg ADD HKLM\SYSTEM\CurrentControlSet\services\LanmanServer\Parameters /v autodisconnect /t REG_DWORD /d 45 /f 
:: Require Security Signature - Disabled pursuant to checklist
reg ADD HKLM\SYSTEM\CurrentControlSet\services\LanmanServer\Parameters /v enablesecuritysignature /t REG_DWORD /d 0 /f 
:: Enable Security Signature - Disabled pursuant to checklist
reg ADD HKLM\SYSTEM\CurrentControlSet\services\LanmanServer\Parameters /v requiresecuritysignature /t REG_DWORD /d 0 /f 
:: Disable Domain Credential Storage
reg ADD HKLM\SYSTEM\CurrentControlSet\Control\Lsa /v disabledomaincreds /t REG_DWORD /d 1 /f 
:: Don't Give Anons Everyone Permissions
reg ADD HKLM\SYSTEM\CurrentControlSet\Control\Lsa /v everyoneincludesanonymous /t REG_DWORD /d 0 /f 
:: SMB Passwords unencrypted to third party? How bout nah
reg ADD HKLM\SYSTEM\CurrentControlSet\services\LanmanWorkstation\Parameters /v EnablePlainTextPassword /t REG_DWORD /d 0 /f
:: Null Session Pipes Cleared
reg ADD HKLM\SYSTEM\CurrentControlSet\services\LanmanServer\Parameters /v NullSessionPipes /t REG_MULTI_SZ /d "" /f
:: Remotely accessible registry paths cleared
reg ADD HKLM\SYSTEM\CurrentControlSet\Control\SecurePipeServers\winreg\AllowedExactPaths /v Machine /t REG_MULTI_SZ /d "" /f
:: Remotely accessible registry paths and sub-paths cleared
reg ADD HKLM\SYSTEM\CurrentControlSet\Control\SecurePipeServers\winreg\AllowedPaths /v Machine /t REG_MULTI_SZ /d "" /f
:: Restict anonymous access to named pipes and shares
reg ADD HKLM\SYSTEM\CurrentControlSet\services\LanmanServer\Parameters /v NullSessionShares /t REG_MULTI_SZ /d "" /f
:: Allow to use Machine ID for NTLM
reg ADD HKLM\SYSTEM\CurrentControlSet\Control\Lsa /v UseMachineId /t REG_DWORD /d 0 /f

goto MENU
:Two
:: Listing possible penetrations
cd C:\
echo "STARTING TO OUTPUT PROCESS FILES DIRECTLY TO THE C:\ DRIVE!"
wmic process list brief > BriefProcesses.txt
if %errorlevel%==1 echo Brief Processes failed to write
wmic process list full >FullProcesses.txt
if %errorlevel%==1 echo Full Processes failed to write
wmic startup list full > StartupLists.txt
if %errorlevel%==1 echo Startup Processes failed to write
net start > StartedProcesses.txt
if %errorlevel%==1 echo Started processes failed to write
reg export HKLM\Software\Microsoft\Windows\CurrentVersion\Run  Run.reg
if %errorlevel%==1 echo Run processes failed to write
goto MENU
:Three
echo "OUTPUT DONE, CHANGING PASSWORD POLICIES!"
:: Passwords must be 10 digits
net accounts /minpwlen:10
:: Passwords must be changed every 30 days
net accounts /maxpwage:30
:: Passwords can only be changed after 5 day has passed
net accounts /minpwage:5
:: Display current password policy
echo "CURRENT POLICY"
PAUSE
net accounts
goto MENU
:Four
:: Find file
@echo off
color 0f
cls
echo Flashing Disk to .flashed Files to reference....
dir /b /s "C:\Program Files\" > programfiles.flashed
dir /b /s "C:\Program Files (x86)\" >> programfiles.flashed
echo Program Files flashed
dir /b /s "C:\Users\" > users.flashed
dir /b /s "C:\Documents and Settings" >> users.flashed
echo User profiles flashed
dir /b /s "C:\" > c.flashed
echo C:\ Flashed
pause
echo Finding media files in C:\Users and/or C:\Documents and Settings...
findstr .mp3 users.flashed >NUL
if %errorlevel%==0 where /r c:\Users\ *.mp3 > media_audio
findstr .ac3 users.flashed >NUL
if %errorlevel%==0 where /r c:\Users\ *.ac3 >> media_audio
findstr .aac users.flashed >NUL
if %errorlevel%==0 where /r c:\Users\ *.aac >> media_audio
findstr .aiff users.flashed >NUL
if %errorlevel%==0 where /r c:\Users\ *.aiff >> media_audio
findstr .flac users.flashed >NUL
if %errorlevel%==0 where /r c:\Users\ *.flac >> media_audio
findstr .m4a users.flashed >NUL
if %errorlevel%==0 where /r c:\Users\ *.m4a >> media_audio
findstr .m4p users.flashed >NUL
if %errorlevel%==0 where /r c:\Users\ *.m4p >> media_audio
findstr .midi users.flashed >NUL
if %errorlevel%==0 where /r c:\Users\ *.midi >> media_audio
findstr .mp2 users.flashed >NUL
if %errorlevel%==0 where /r c:\Users\ *.mp2 >> media_audio
findstr .m3u users.flashed >NUL
if %errorlevel%==0 where /r c:\Users\ *.m3u >> media_audio
findstr .ogg users.flashed >NUL
if %errorlevel%==0 where /r c:\Users\ *.ogg >> media_audio
findstr .vqf users.flashed >NUL
if %errorlevel%==0 where /r c:\Users\ *.vqf >> media_audio
findstr .wav users.flashed >NUL
if %errorlevel%==0 where /r c:\Users\ *.wav >> media_audio
findstr .wma users.flashed >NUL
if %errorlevel%==0 where /r c:\Users\ *.wma >> media_video
findstr .mp4 users.flashed >NUL
if %errorlevel%==0 where /r c:\Users\ *.mp4 >> media_video
findstr .avi users.flashed >NUL
if %errorlevel%==0 where /r c:\Users\ *.avi >> media_video
findstr .mpeg4 users.flashed >NUL
if %errorlevel%==0 where /r c:\Users\ .mpeg4 >> media_video
:: BREAKLINE
findstr .gif users.flashed >NUL
if %errorlevel%==0 where /r c:\Users\ *.gif >> media_pics
findstr .png users.flashed >NUL
if %errorlevel%==0 where /r c:\Users\ *.png >> media_pics
findstr .bmp users.flashed >NUL
if %errorlevel%==0 where /r c:\Users\ *.bmp >> media_pics
findstr .jpg users.flashed >NUL
if %errorlevel%==0 where /r c:\Users\ .jpg >> media_pics
findstr .jpeg users.flashed >NUL
if %errorlevel%==0 where /r c:\Users\ .jpeg >> media_pics
C:\WINDOWS\system32\notepad.exe media_video
C:\WINDOWS\system32\notepad.exe media_audio
C:\WINDOWS\system32\notepad.exe media_pics
echo Finding Hacktools now...
findstr "Cain" programfiles.flashed
if %errorlevel%==0 (
echo Cain detected. Please take note, then press any key.
pause >NUL
)
cls
findstr "nmap" programfiles.flashed
if %errorlevel%==0 (
echo Nmap detected. Please take note, then press any key.
pause >NUL
)
cls
findstr "keylogger" programfiles.flashed
if %errorlevel%==0 (
echo Potential keylogger detected. Please take note, then press any key.
pause >NUL
)
cls
findstr "Armitage" programfiles.flashed
if %errorlevel%==0 (
echo Potential Armitage detected. Please take note, then press any key.
pause >NUL
)
cls
findstr "Metasploit" programfiles.flashed
if %errorlevel%==0 (
echo Potential Metasploit framework detected. Please take note, then press any key.
pause >NUL
)
cls
findstr "Shellter" programfiles.flashed
if %errorlevel%==0 (
echo Potential Shellter detected. Please take note, then press any key.
pause >NUL
)
cls
goto MENU
:Five
:: No Remote Desktop
echo "DISABLING REMOTE DESKTOP"
reg add "HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server" /v fDenyTSConnections /t REG_DWORD /d 1 /f
reg add "HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server\WinStations\RDP-Tcp" /v UserAuthentication /t REG_DWORD /d 0 /f
goto MENU
:Six
:: Windows auomatic updates
echo "ENABLING AUTO-UPDATES"
reg add "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WindowsUpdate\Auto Update" /v AUOptions /t REG_DWORD /d 3 /f
goto MENU
:Seven
:: Removing good ol' insecure stuff
echo "DISABLING WEAK SERVICES"
dism /online /disable-feature /featurename:IIS-WebServerRole
dism /online /disable-feature /featurename:IIS-WebServer
dism /online /disable-feature /featurename:IIS-CommonHttpFeatures
dism /online /disable-feature /featurename:IIS-HttpErrors
dism /online /disable-feature /featurename:IIS-HttpRedirect
dism /online /disable-feature /featurename:IIS-ApplicationDevelopment
dism /online /disable-feature /featurename:IIS-NetFxExtensibility
dism /online /disable-feature /featurename:IIS-NetFxExtensibility45
dism /online /disable-feature /featurename:IIS-HealthAndDiagnostics
dism /online /disable-feature /featurename:IIS-HttpLogging
dism /online /disable-feature /featurename:IIS-LoggingLibraries
dism /online /disable-feature /featurename:IIS-RequestMonitor
dism /online /disable-feature /featurename:IIS-HttpTracing
dism /online /disable-feature /featurename:IIS-Security
dism /online /disable-feature /featurename:IIS-URLAuthorization
dism /online /disable-feature /featurename:IIS-RequestFiltering
dism /online /disable-feature /featurename:IIS-IPSecurity
dism /online /disable-feature /featurename:IIS-Performance
dism /online /disable-feature /featurename:IIS-HttpCompressionDynamic
dism /online /disable-feature /featurename:IIS-WebServerManagementTools
dism /online /disable-feature /featurename:IIS-ManagementScriptingTools
dism /online /disable-feature /featurename:IIS-IIS6ManagementCompatibility
dism /online /disable-feature /featurename:IIS-Metabase
dism /online /disable-feature /featurename:IIS-HostableWebCore
dism /online /disable-feature /featurename:IIS-StaticContent
dism /online /disable-feature /featurename:IIS-DefaultDocument
dism /online /disable-feature /featurename:IIS-DirectoryBrowsing
dism /online /disable-feature /featurename:IIS-WebDAV
dism /online /disable-feature /featurename:IIS-WebSockets
dism /online /disable-feature /featurename:IIS-ApplicationInit
dism /online /disable-feature /featurename:IIS-ASPNET
dism /online /disable-feature /featurename:IIS-ASPNET45
dism /online /disable-feature /featurename:IIS-ASP
dism /online /disable-feature /featurename:IIS-CGI
dism /online /disable-feature /featurename:IIS-ISAPIExtensions
dism /online /disable-feature /featurename:IIS-ISAPIFilter
dism /online /disable-feature /featurename:IIS-ServerSideIncludes
dism /online /disable-feature /featurename:IIS-CustomLogging
dism /online /disable-feature /featurename:IIS-BasicAuthentication
dism /online /disable-feature /featurename:IIS-HttpCompressionStatic
dism /online /disable-feature /featurename:IIS-ManagementConsole
dism /online /disable-feature /featurename:IIS-ManagementService
dism /online /disable-feature /featurename:IIS-WMICompatibility
dism /online /disable-feature /featurename:IIS-LegacyScripts
dism /online /disable-feature /featurename:IIS-LegacySnapIn
dism /online /disable-feature /featurename:IIS-FTPServer
dism /online /disable-feature /featurename:IIS-FTPSvc
dism /online /disable-feature /featurename:IIS-FTPExtensibility
dism /online /disable-feature /featurename:TFTP
dism /online /disable-feature /featurename:TelnetClient
dism /online /disable-feature /featurename:TelnetServer
goto MENU
:Eight
:: start sys integrity scan
echo "Beginning system integrity scan."
echo "If it fails make sure you can access sfc.exe"
sfc.exe /scannow
goto MENU
:Nine
:: PowerShell RootKit detection start
echo "POWERSHELL ROOTKIT DETECTION WITH MALWAREBYTES ROOTKIT BETA (Requires powershell execution policy)"
:: Downloads MalwareBytes scan file
powershell Invoke-WebRequest -OutFile MBRTKit.exe https://data-cdn.mbamupdates.com/web/mbar-1.10.3.1001.exe
MBRTKit.exe
goto MENU
PAUSE

# this script secures the Administrators local group
$allowedAdminsPath = "$($env:USERPROFILE)\Desktop\allowedAdmins.txt"
$unauthAdminsPath = "$($env:USERPROFILE)\Desktop\unauthAdmins.txt"
$allowedAdminsTempPath = "$($env:LOCALAPPDATA)\Temp\allowedAdminsTemp.txt"
$unauthAdmins = Get-LocalGroupMember -Group Administrators | Where-Object { (Get-Content $allowedAdminsTempPath) -notcontains $_.Name }

Write-Output "Warning: Ensure that the list of administrators is correct at [$allowedAdminsPath] before running this script."
Read-Host -Prompt "Press any key to continue..."

Get-Content -Path "$allowedAdminsPath" | ForEach-Object { "$($env:COMPUTERNAME)\$_" } | Set-Content -Path "$allowedAdminsTempPath"
Write-Output "[$allowedAdminsPath] modified"

try {
    $unauthAdmins | Select-Object -ExpandProperty Name | Out-File -FilePath "$unauthAdminsPath"
    $unauthAdmins | Remove-LocalGroupMember -Group "Administrators" -Confirm -ErrorAction Inquire
    Write-Output "Changed permissions for unauthorized administrators. User log at: [$unauthAdminsPath]. Keep in mind that the users are still present, just no longer administrators."
    Read-Host "Press any key to exit"
}
catch {
    Write-Output "An error occurred: $($_.Exception.Message)"
}

# this script accesses the README file for a list of authorized users and administrators, checks it against the current list of users on the machine, removes unauthorized users upon user confirmation, and records the results in a log file.
# check if running with administrative privileges 
if (-NOT ([Security.Principal.WindowsPrincipal] [Security.Principal.WindowsIdentity]::GetCurrent()).IsInRole([Security.Principal.WindowsBuiltInRole]::Administrator)) {
    Write-Output "Please run this script as an administrator."
    Read-Host -Prompt "Press enter to exit"
    exit
} else {
    Write-Output "This script takes the lists of users and administrators on the README page as input, removes unauthorized users on this system, and logs them at [$unauthUserPath]"
    Read-Host -Prompt "Press enter to continue"
}

# Generate a unique name for a temporary file
$tempName = New-Guid
# set the path for the logfile
$unauthUserPath = "$($env:USERPROFILE)\Desktop\unauthUsers.txt"
# Initialize an empty array to store the inner text of <pre> elements
$rawInnerText = @()
# initialize array with the default local user accounts (https://learn.microsoft.com/en-us/windows/security/identity-protection/access-control/local-accounts)
$defaultAccounts = @(
    "Administrator",
    "DefaultAccount",
    "Guest",
    "HelpAssistant",
    "KRBTGT",
    "LOCAL SERVICE",
    "NETWORK SERVICE",
    "SYSTEM",
    "WDAGUtilityAccount"
)

# Get the URL from a .url file on the Desktop
$url = Get-Content -Path "$($env:USERPROFILE)\Desktop\README.url" | Where-Object { $_ -match "url=(.*)" }
# Extract the URL from the match
$url = $matches[1]
# Send a web request to the URL
$response = Invoke-WebRequest -Uri "$url"
# Get all <pre> elements from the parsed HTML of the web response
$preElements = $response.ParsedHtml.getElementsByTagName("pre")

# Loop through each pre element and add its InnerText property to the array
foreach ($element in $preElements) {
 $rawInnerText += $element.InnerText
}
# Write the array to a temporary file
$rawInnerText | out-file -filePath “$($env:TEMP)\$tempName.tmp”

# Read the temporary file
$temp = Get-Content -Path "$($env:TEMP)\$tempName.tmp"
# Filter out lines containing 'password' and 'Authorized'
$allowedUsers = $temp | Where-Object { $_ -notmatch "password" } | Where-Object { $_ -notmatch "Authorized" }
# Remove ' (you)' from each line
$allowedUsers = $allowedUsers -replace ' \(you\)', '' | Where-Object { $_ -ne "" }

# Delete the temporary file
Remove-Item -Path "$($env:TEMP)\$tempName.tmp"

# compare the list of local accounts to the default list and the list accessed from the README
$unauthUsers = Get-LocalUser | Where-Object { $allowedUsers -notcontains $_.Name } | Where-Object { $defaultAccounts -notcontains $_.Name}

try
{
    # for every user account in the array, record its name in the logfile
    $unauthUsers | Select-Object -ExpandProperty Name | Out-File -FilePath $unauthUserPath
    # attempt to remove the account with user confirmation
    $unauthUsers | Remove-LocalUser -Confirm -ErrorAction Inquire
    Write-Output "Done removing unauthorized users, log can be found at [$unauthUserPath]"
    Read-Host -Prompt "Press enter to exit"
}
catch {
    Write-Output "An error occurred: $($_.Exception.Message)"
}
::========================================================================
:: Code by: 
::        _ __                                      _ ___ __            _ 
::       (_) /_  __  ______  ____ _      ____ ___  (_) (_) /___ _____  (_)
::      / / __ \/ / / / __ \/ __ `/_____/ __ `__ \/ / / / / __ `/ __ \/ / 
::     / / / / / /_/ / / / / /_/ /_____/ / / / / / / / / / /_/ / / / / /  
::  __/ /_/ /_/\__,_/_/ /_/\__, /     /_/ /_/ /_/_/_/_/_/\__,_/_/ /_/_/   
:: /___/                  /____/                                          
::======================================================================== 

@echo off 

:: The delimiter used here is a comma, but you can use space as a delimiter as well. 
set servicesStopList=PlugPlay, Spooler
set servicesStartList=
set windowsUpdateServices=wuauserv

:: This loop iterates over the given array and stops and disables those services. TODO: make array mutable by prompting user. 
for %%i in (%servicesStopList%) do (
   call :stopService %%i 
   call :disableService %%i 
) 
exit /b 0

:: This function uses the Service Control Manager to stop the service that is passed through it as a parameter. 
:stopService 
sc stop %~1
if ERRORLEVEL 1 echo Unable to stop %~1. Check to see if it is already stopped. 
   pause 
exit /b 0 

:: This function uses the Service Control Manager to disable the service that is passed through it as a parameter. 
:disableService 
sc config %~1 start=disabled
if ERRORLEVEL 1 echo Unable to disable %~1. Check to see if it is already disabled. 
   pause 
exit /b 0 

:: This function uses the Service Control Manager to start the service that is passed through it as a parameter. 
:startService 
sc start %~1 
if ERRORLEVEL 1 echo Unable to start %~1. Check to see if it is already started. 
   pause 
exit /b 0 

cmd /k 

goto :main

#----------------------------------------
#   BarbraRedPanda
#   2022 Cyberpatriot Windows 10 Script
#   https://github.com/BarbraRedPanda/cyberpatriot/
#----------------------------------------

:main
@echo off
color 08

rem checks if there are sufficient privs 
net session
if %errorlevel%==0 (
 	echo "We're in. hacking itno mainframe. initiansting fortniteburger."
) else (
    echo "you suck"
 	pause
    exit
)

cls

set /p forensics=have you read the readme and the forensics (y/n)?
if "%forensics%"=="y" goto :launch
if "%forensics%"=="n" (
    echo "do them now"
    pause
    exit
)

:launch
    cls
    echo "#&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&(((((((((("
    echo "#&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&(((((((((("
    echo "#&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&(((((((((("
    echo "&&&&&&&&&&&&&&&&&&&&@&&&&@&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&&(((((((((("
    echo "&&&&&&&&&&&&&&&&&&&&&&&&&@&&&&&((#( ..*((/,,/#((/#&&&&&&&&&&&&&&&&&&&&(((((((((("
    echo "/&&&&&&&&&&&&&&&@@@@@&@@@@@&((#*...    .,,,*///,   ((&&&&&&&&&&&&&&&&&&&&&&&&&&&"
    echo "(&&&&&&&&&&&@@@@@@@@@@@@((/////.... .  *****////((/*/./#@&@&&&&&&&&&&&&&&&&&&&&&"
    echo "/&&&&&&&&&@@@@@@@@@@&(&##&((&#(**.,... *,*////*/(((*&(#,./@&@&&&&&&&&&&&&&&&&&&&"
    echo "/&&&&&&@@@@@@@@@@@&& ##&&&&&&#//*,.*. .**(((((/(/(#//(*  ,/@&&@@@&&&&&&&&&&&&&&&"
    echo "/&@&@&@@@@@@@@@@@@# ...,.&&&&#//*,,*,,*/((##&&&&#**,**,,.,.(#&@&@@@&@&&&&&&&&&&&"
    echo ".&&&@&@@@@@@@@@@@&(.#&&&&&#//*#//*//**/((#&#*/&@@&&@@&&/&(/ ##  @@@@@@&&&&&&&&&&"
    echo "*&&&@&@@@@@@@@@@@&(./#/&&@@&&&@&(&#(**(#&(@@&@@&&&&&#//&&((,*##.@&@@@@&&&&&&&&&&"
    echo "/&&@@@@@@@@@@@@@###( ,*,*///*///&&@&((&@@@&#&##((////*.** ,/(.,.@@@@@@@@&&&&&&&&"
    echo "/&&&@&@@@@@@@@@@*/& .,*#((. ....***(/*/.,**,,.. ,*,..,/((,,&((  &@@@@@@&&&&&&&&&"
    echo "/&&&@&@@@@@@@@@@&* &@@.. . ...   .  &&&   .. . ....  .    .*/*#(@@@@@@@@&@&&&&&&"
    echo ",&&&@&&&@@@@@@@@&*. /&...  ....   .#@@@&. ..*  *. ...../##&/,*#@@@@@@@@@@@&&&&&&"
    echo "&&&&&&&@@@@@@@@@(,.,/&.  .. ......@@@@@. * ...,,.,.*&&&.*&(&/&@@@@@@@@@@@&&&&&&"
    echo "&&&&&&&&&@@@@@@@( (&.,#@@@@&&&#&##&@@@@#(#((&&#&&@#.,*(#&&&#@@@@@@@@@@@@&@&&&&&"
    echo "&&&&&&&&&@@@@@@@@.,&*(&(.. (&*//(&@@@@@@*(/(*/(..*&##&#/#&#&@@@@@@@@@@@@@@&&&&&"
    echo "&&&&&&&&&&&@@@@@@/./,//**/,*..*#.@@@@@@@**///((//**,**////@@@@@@@@@@@@@@@@&&&&&"
    echo "&&&&&&&&&&@&@@@@@@&@* .... ,,. . /#&&&&( ,//...*******. .@@@@@@@@@@@@@@@@@@&&&&"
    echo "&&&&&&&&&&&@&@@@@@@@@@ ..  .,..* ....  .*/(/**,**,/. . ..@&@@@@@@@@@@@@@@@&&&&&"
    echo "&&&&&&&&&&&&&@@@@@@@@&&    .. . . ....///*/,..,**,, . . &@@@@@@@@@@@@@@@@@@@&&&"
    echo "&&&&&&&&&&&&&@&@@@@@@@&&.  .     . .......    .*,,,... &&@@@@@@@@@@@@@@@&@@@&&&"
    echo "&&&&&&&&&&&&&&&@@@@@@@@@  . ..... ......  .....,,.  ..,&@@@@@@@@@@@@@@@@@@@&@&&"
    echo "&&&&&&&&&&&&&&&&&@@@@@@@* ...... ..  . ...  ,,.,,.   .*@@@@@@@@@@@@@@@@@&&&&&&&"
    echo "&&&&&&&&&&&&&&&&&@&&&@@@#. ... ..   ....   .....,. .. ,@@@@@@@@@@@@@@@@@&&&&&&&"
    echo "&&&&&&&&&&&&&&&&&&&&# ...  . ...     . ... . ....  . ..,&&@@@@@@&@@@@@&&&&&&&&&"
    echo "&&&&&&&&&&&&&&#,.. . .  .. ..,.. ..... . .. . . . ...   .    ..,*&@@&&&&&&&&&&&"
    echo "&&&&&&&&&/..   . .. .    .  .,,, .   .  .. ..  .. ....   ...  .,..... ./&&&&&&&"
    echo "&(. . . . .. .   .. .. . .......    .      . ...  ... .      ... .............*"
    echo ". ... .  ..  .   ... .    .  ...   .  .  . . .  ..     . .  ..,..,............."
    echo #-------------------------------------------------------------------------------#
    echo #-                     BarbraRedPanda CyberPatriot Script                      -#
    echo #-------------------------------------------------------------------------------#
    echo #-                            'We like fortnite'                               -#
    echo #-                     -Tyler 'Fortnite' 'Ninja' Blevins                       -#
    echo #-------------------------------------------------------------------------------#
    echo #       (0) password policy  (1) lockout policy  (2) audit (3) firewall         #
    echo #       (4) hidden folders   (5) remote console  (6) remote access              #
    echo #       (7) guest/admin      (8) telnet.         (9) search and destroy         #
    echo #-------------------------------------------------------------------------------#
    set /p choice=choose an option: 
        timeout /t 1
        echo hackign into the mainfraime and intitiaigng feorntie boirger bprotogocals.
        timeout /t 1
        echo hackign into the mainfraime and intitiaigng feorntie boirger bprotogocals..
        timeout /t 1
        echo hackign into the mainfraime and intitiaigng feorntie boirger bprotogocals...
        timeout /t 1
        echo hackign into the mainfraime and intitiaigng feorntie boirger bprotogocals..
        timeout /t 1
        echo hackign into the mainfraime and intitiaigng feorntie boirger bprotogocals.
        timeout /t 1
        goto :trollface
        :back
        cls
        if "%choice%"=="0" goto :passPol
        if "%choice%"=="1" goto :lockPol
        if "%choice%"=="2" goto :audit
        if "%choice%"=="3" goto :firewall
        if "%choice%"=="4" goto :hidden
        if "%choice%"=="5" goto :remoteConsole
        if "%choice%"=="6" goto :remoteAccess
        if "%choice%"=="7" goto :guestAdmin
        if "%choice%"=="8" goto :telnet
        if "%choice%"=="9" goto :findBad

:passPol
    Rem changes pass reqs
    net accounts /MINPWLEN:8
    net accounts /MAXPWAGE:30
    net accounts /MINPWAGE:15
    net accounts /UNIQUEPW:24

    rem shitty way to create a basic config file in C:/  
    echo [Unicode] > C:\pass.cfg
    echo Unicode=yes >> C:\pass.cfg
    echo [System Access] >> C:\pass.cfg
    echo PasswordComplexity=1 >> C:\pass.cfg
    echo [Version] >> C:\pass.cfg
    echo signature="$CHICAGO$" >> C:\pass.cfg
    echo Revision=1 >> C:\pass.cfg
    rem executes the shitty config file
    secedit.exe /configure /cfg C:\pass.cfg /areas SECURITYPOLICY
    rem Set-ADDefaultDomainPasswordPolicy -ComplexityEnabled true
    rem Set-ADDefaultDomainPasswordPolicy -ReversibleEncryptionEnabled false
    rem Set-ADDefaultDomainPasswordPolicy -PasswordHistoryCount 24
    pause   
    goto :launch

:lockPol
    Rem changes lockout stuff
        rem Set-ADDefaultDomainPasswordPolicy -LockoutThreshold 5
        rem Set-ADDefaultDomainPasswordPolicy -LockoutDuration 0.0:30:0.0
        rem Set-ADDefaultDomainPasswordPolicy -LockoutObservationWindow 0.0:30:0.0
    net accounts /LOCKOUTTHRESHOLD:5
    net accounts /LOCKOUTDURATION:30
    net accounts /LOCKOUTWINDOW:30
    pause
    goto :launch


:audit
    auditpol /set /category:* /success:enable
    auditpol /set /category:* /failure:enable

    pause
    goto :launch

:firewall
    netsh advfirewall set allprofiles state on
    pause
    goto :launch

:hidden
    rem shows hidden folders
    reg add HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced /v Hidden /t REG_DWORD /d 1 /f
    reg add HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced /v ShowSuperHidden /t REG_DWORD /d 1 /f
    powershell -c gps 'explorer' ^| stop-process

    pause   
    goto :launch

:remoteConsole
    rem disable remote console access
    sc stop "TermService"
    sc config "TermService" start= disabled
    sc stop "SessionEnv"
    sc config "SessionEnv" start= disabled
    sc stop "UmRdpService"
    sc config "UmRdpService" start= disabled
    sc stop "RemoteRegistry"
    sc config "RemoteRegistry" start= disabled

    pause   
    goto :launch

:remoteAccess
    rem disable remote access
    reg add "HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server" /v "fDenyTSConnections" /t REG_DWORD /d "1" /f
    pause   
    goto :launch

:guestAdmin
    rem disables guest and admin accounts
    net user administrator /active:no
    net user guest /active:no
    pause
    goto :launch

:telnet
    DISM  /online /disable-feature /featurename:TelnetClient
    DISM /online /disable-feature /featurename:TelnetServer
    sc stop "TlntSvr"
    sc config "TlntSvr" start= disabled
    pause
    goto :launch

:findBad
    cd C:/Users/
    rem very weird way of writing the paths of any files in a new file on the desktop
    dir *.png  *.jpg  *.jpeg  *.mp3  *.mp4  *.gif  *.mov  *.wav  *.img  *.webp  *.ac3  *.aac  *.aiff  *.flac  *.m4a  *.m4p  *.midi  *.exe  *.mp2  *.avi  *.wma  *.ogg  *.m3u  *.bmp  *.mpeg4 *.vqf /b/s/a/d > %userprofile%\Desktop\fortnite.txt
    pause
    goto :launch










:trollface
    cls
    echo "@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&&&&################&&&&&&&&@@@@@@@@@@@@@@@@@@@@@@@@@@@"
    echo "@@@@@@@@@@@@@@@@@@@@@@@@@@@@@&#BGPP5YJJ?????77777777 |lllllll~~^::.::::::^^~l?P#@@@@@@@@@@@@@@@@@@@@@"
    echo "@@@@@@@@@@@@@@@@@@&#G5J?7l~~~~^^^^^^^~~~~~^^^^^^^^^^^^^::::::^~~ll~:          .lG@@@@@@@@@@@@@@@@@@@"
    echo "@@@@@@@@@@@@@@@B57^.^~^~llll~~^^^^^~~ll777777l~^^^^^^^^^~~~llll~^^^l7l~.         7&@@@@@@@@@@@@@@@@@"
    echo "@@@@@@@@@@@@#Y~.    :   ..::^^^^^^:::::::..      .^^^^^~~~~~~~~ll77l~^~l7~.       ^B@@@@@@@@@@@@@@@@"
    echo "@@@@@@@@@@B7.       ^ll~~^^^^^^~~l77.           :?l       ...:^^~~ll777~:^~~:.     :G@@@@@@@@@@@@@@@"
    echo "@@@@@@@@@&^        77:.          ~7.           .5:                 :~l~^l~. ..      .G@@@@@@@@@@@@@@"
    echo "@@@@@@@@@#.       :^              7~           .~    .^~77????7l~^.   ^: .:.         .P@@@@@@@@@@@@@"
    echo "@@@@@@@@&l           .:~llll~^.   ~l             :75BBBG5B@@@@@@&&#GJ^                 J@@@@@@@@@@@@"
    echo "@@@@@@&P^ .   .... :JB&BGGB&@&#G5?^.           ~P&#Yl:...7@@@@@@@@PYG&5: :^::.     .^^^:?&@@@@@@@@@@"
    echo "@@@@@5~~7J7~^:^^~^ ~PGBGGBB#&&@@@@&P7?Y7      ^@@G:.^?PB#BBGP555PGGGG&&J ^7?J:  ..:^~~~ll7J5G&@@@@@@"
    echo "@@@B~l?7ll^           ..:::^^~l7JP&@#PY~      .7G##BG5?l^:. ~P?:   .:^:  :::lJPGGGGGPY7:  .^llY&@@@@"
    echo "@@#^?l:J~^7Y5P5YJl^.              P@l            :l:        .Y#&GJl^::^~?YB&@#P7~~^^l?5#Gl   ^.^G@@@"
    echo "@@Y7l l~ ?GPYJ??JB@#5ll5B~       ^B@l                         .~?5PPPPPP5Y?l^   GG     :5@Y  .l .B@@"
    echo "@@YY: 7^ .    75 .5GGGP57.    .7G&#5:           ^l~^:  :                   .^75B@@P~.    P@7 .7  7@@"
    echo "@@BYl :?^    :B@~          .~5#&Y~.            .YPGBBGl?^^^^^^^.      .^7YG##GY7l#@@#57: 5@J .l  7@@"
    echo "@@@BP~:^l:  :B@@?      .:~7P@&@#^         ^7JYYJ?~  5@? :::...:  :~?5G#&&GJ~.   7&#?7JY~l@B: ~~  G@@"
    echo "@@@@#J~l77..B@#&#J^   ^l~^.:7^~P#J:   :.  ?55YYYPJ.P&B:   .:~7YPB###G#@J.     ^5&@J     G5. ^5 .5@@@"
    echo "@@@@@&7  : ?@&G&&#&GJ~:         ~P#GYGG:          :??l7J5GBBBP5?l^: :#@? :~7YG&@@P~     :.:~7^7#@@@@"
    echo "@@@@@@&^   5@&@#~J@#G&&B5J?l~^::..^J5J^::^^~l?JYPGBBBB&@G~^.      .lB@&###BGG&@Bl       .::~JB@@@@@@"
    echo "@@@@@@@Y   G@&@? 5@7 :~G@#PB##BB##BBBBBBGG&&BP5J7l~^: 7@B   .^~7YP#@@&&#J^ ~B@Y.         ^J#@@@@@@@@"
    echo "@@@@@@@G   G@&@P7#@J  ~&&~  ....?@&l::.. .##.         .B@55B#&@@@&BY5@#.  J@#l          l#@@@@@@@@@@"
    echo "@@@@@@@B.  5@&&@@&&#P5G@#J7l~~~^?@G~~~~~~l#&l^~~l7JYPGB&&@@&#B5Jl:  ^&#7JB@5:          ~&@@@@@@@@@@@"
    echo "@@@@@@@B.  7@&&&&&&&@@@&&@@@@@&&&&&&&&&&&&&&&&@@@@@@@&B5B@Y:.        ?&@@G~           :B@@@@@@@@@@@@"
    echo "@@@@@@@G   :#@B&@&&@&&&@@&&&@@@@&&&&@@@@@@@@&&#GP5Jl^:  Y@P       ^?G&&P~            ^B@@@@@@@@@@@@@"
    echo "@@@@@@@5    ?@BJB@5J&@B5B#&&BGGG#@&#PPP5YJ7l##:         :G@P.  ^?G&@G?:            :J&@@@@@@@@@@@@@@"
    echo "@@@@@@@?     Y@BP&B.~&#7 :B@Y   :J&&:      .#&^          .G@PYB&#P?:   .    ..   ^Y#@@@@@@@@@@@@@@@@"
    echo "@@@@@@&^      ?#@&GJl5@&~ ^#@J    Y@?      .B@l   ..^~7JPG#&#PJ~. .^~~^^^l??l::7P&@@@@@@@@@@@@@@@@@@"
    echo "@@@@@@B.       .~JPB##&@&BG#@@PYJ?5@#JJ???JY#@#BGBB####BPJl:..:~77l~~l?JJ7~~?P&@@@@@@@@@@@@@@@@@@@@@"
    echo "@@@@@@P    .    :   .:^~l7?JJY555PP5PPPPPP55YJJ??7l~^..  .^l77lll7??7l^~75B@@@@@@@@@@@@@@@@@@@@@@@@@"
    echo "@@@@@@J   :?    ^J7^.        :^^^^^^^^:^^^^.       .:^~77?77777l~^^~?5B@@@@@@@@@@@@@@@@@@@@@@@@@@@@@"
    echo "@@@@@@?   .l^.   .~?J?7l~^::........:.....::^^~~ll7???77ll~^:.^lJG#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@"
    echo "@@@@@@7     ^77l~^.  .:::::::.......:::::^^~~llll~~^:..  .~?P#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@"
    echo "@@@@@@5       .^~l777ll~~^^^^^^^^^^^^^^^:::..        .~JG#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@"
    echo "@@@@@@@P^                                  .:^~^^^lJG#@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@"
    echo "@@@@@@@@&P7:                        ..^~?YPB&&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@"
    echo "@@@@@@@@@@@&BPY?7l~^^^^^^^^~~l7?J5PGB#&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@"
    echo "@@@@@@@@@@@@@@@@@@@@@&&&&@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@"
    timeout /t 1
    goto :back


goto :main 
    
:main
@echo off
color 08

:: checks for admin
net session
if %errorlevel%==0 (
 	echo "We're in. hacking itno mainframe. initiansting fortniteburger."
) else (
    echo "you suck"
 	pause
    exit
)

:launch

    cls    
    echo #-------------------------------------------------------------------------------#
    echo #-                       Parsa's CyberPatriot Script                           -#
    echo #-------------------------------------------------------------------------------#
    echo #-                            'We like fortnite'                               -#
    echo #-                     -Tyler 'Fortnite' 'Ninja' Blevins                       -#
    echo #-------------------------------------------------------------------------------#
    echo #         (0) password    (1) lockout    (2) audit    (3) firewall              #
    echo #                                                                               #
    echo #             (4) remote   (5) guest   (6) rm -rf   (7) clear                   #
    echo #-------------------------------------------------------------------------------#
    
    set /p choice=Choose an option: 
        if "%choice%"=="0" goto :pass
        if "%choice%"=="1" goto :lock
        if "%choice%"=="2" goto :audit
        if "%choice%"=="3" goto :fw 
        if "%choice%"=="4" goto :remote
        if "%choice%"=="5" goto :guest
        if "%choice%"=="6" goto :rm
        if "%choice%"=="7" goto :clear
        else goto :launch
        
:pass
    :: pass requirements
    net accounts /MINPWLEN:14
    net accounts /MAXPWAGE:30
    net accounts /MINPWAGE:15
    net accounts /UNIQUEPW:24

    rem change passes
    for /f "tokens=*" %%a in ('type %path%resources\users.txt') do (
        net user "%%a" "LarryKedigh#1Fan!!!"
        C:\Windows\System32\wbem\wmic UserAccount where Name="%%a" set PasswordExpires=True
    )
    :: Made passwords expire, and set passwords

    pause
    goto :launch

:lock
    ::changes lockout duration
    net accounts /LOCKOUTTHRESHOLD:5
    net accounts /LOCKOUTDURATION:30
    net accounts /LOCKOUTWINDOW:30
    ::doesn't show last logged in
    reg add "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" /v dontdisplaylastusername /t REG_DWORD /d 1 /f
    pause
    goto :launch

:audit
    auditpol /set /category:* /success:enable
    auditpol /set /category:* /failure:enable

    pause
    goto :launch

:fw
    netsh advfirewall set allprofiles state on
    echo Firewall enabled
    echo Setting basic firewall rules..
    netsh advfirewall firewall set rule name="Remote Assistance (DCOM-In)" new enable=no 
    netsh advfirewall firewall set rule name="Remote Assistance (PNRP-In)" new enable=no 
    netsh advfirewall firewall set rule name="Remote Assistance (RA Server TCP-In)" new enable=no 
    netsh advfirewall firewall set rule name="Remote Assistance (SSDP TCP-In)" new enable=no 
    netsh advfirewall firewall set rule name="Remote Assistance (SSDP UDP-In)" new enable=no 
    netsh advfirewall firewall set rule name="Remote Assistance (TCP-In)" new enable=no 
    netsh advfirewall firewall set rule name="Telnet Server" new enable=no 
    netsh advfirewall firewall set rule name="netcat" new enable=no
    goto :launch

:remote
    :: disable remote console access
    sc stop "TermService"
    sc config "TermService" start= disabled
    sc stop "SessionEnv"
    sc config "SessionEnv" start= disabled
    sc stop "UmRdpService"
    sc config "UmRdpService" start= disabled
    sc stop "RemoteRegistry"
    sc config "RemoteRegistry" start= disabled

    :: disable remote access
    reg add "HKLM\SYSTEM\CurrentControlSet\Control\Terminal Server" /v "fDenyTSConnections" /t REG_DWORD /d "1" /f
    pause   
    goto :launch

:guest
    net user guest /active:no
    pause
    goto :launch


:rm
    :: creates a new rich-text (.txt) file (called "BadFiles.txt") on current user's desktop and lists all items of
    :: goofy file types in the 'C:/Users/' directory
    cd C:/Users
    dir /b/s/a/d *.txt >> C:/Users/%username%/Desktop/BadFiles.txt
    dir /b/s/a/d *.mp3 >> C:/Users/%username%/Desktop/BadFiles.txt
    dir /b/s/a/d *.mp4 >> C:/Users/%username%/Desktop/BadFiles.txt
    dir /b/s/a/d *.wav >> C:/Users/%username%/Desktop/BadFiles.txt
    dir /b/s/a/d *.mpeg >> C:/Users/%username%/Desktop/BadFiles.txt
    dir /b/s/a/d *.docx >> C:/Users/%username%/Desktop/BadFiles.txt
    dir /b/s/a/d *.doc >> C:/Users/%username%/Desktop/BadFiles.txt
    dir /b/s/a/d *.png >> C:/Users/%username%/Desktop/BadFiles.txt
    dir /b/s/a/d *.pdf >> C:/Users/%username%/Desktop/BadFiles.txt
    dir /b/s/a/d *.jpg >> C:/Users/%username%/Desktop/BadFiles.txt
    dir /b/s/a/d *.jpeg >> C:/Users/%username%/Desktop/BadFiles.txt
    dir /b/s/a/d *.stl >> C:/Users/%username%/Desktop/BadFiles.txt
    dir /b/s/a/d *.zip >> C:/Users/%username%/Desktop/BadFiles.txt
    dir /b/s/a/d *.gif >> C:/Users/%username%/Desktop/BadFiles.txt
    dir /b/s/a/d *.html >> C:/Users/%username%/Desktop/BadFiles.txt
    dir /b/s/a/d *.css >> C:/Users/%username%/Desktop/BadFiles.txt
    dir /b/s/a/d *.js >> C:/Users/%username%/Desktop/BadFiles.txt
    dir /b/s/a/d *.php >> C:/Users/%username%/Desktop/BadFiles.txt
    dir /b/s/a/d *.rar >> C:/Users/%username%/Desktop/BadFiles.txt
    dir /b/s/a/d *.py >> C:/Users/%username%/Desktop/BadFiles.txt
    dir /b/s/a/d *.svg >> C:/Users/%username%/Desktop/BadFiles.txt
    dir /b/s/a/d *.ogg >> C:/Users/%username%/Desktop/BadFiles.txt
    dir /b/s/a/d *.avi >> C:/Users/%username%/Desktop/BadFiles.txt
    echo "Copied every unusual files in the Users directory onto the desktop as BadFiles.txt"
    echo "Check the file to make sure there are no critical files"
    echo "If there are, remove them from the list :)"
    pause
    goto :launch


:clear
    :: clears all of the files in the "BadFiles.txt" file from the :rm method
    :: Allows the user to change the BadFiles.txt if there are any necessary files in the directory
    for /F "usebackq delims=" %%A in ("C:/Users/%username%/Desktop/BadFiles.txt") do (
        set "filepath=%%A"
        echo Deleting: !filepath!
        del "!filepath!"
    )

    pause
    goto :launch

function Set-AdminAccounts {
    $Response = (Read-Host "Enter which accounts should be admin. Example: account1,account2")
    $AdminsList = $Response.Split(",")

    $AllUsers = Get-LocalUser

    # Don't mess with these accounts
    $DefaultAccounts = @('Administrator', 'DefaultAccount', 'Guest', 'WDAGUtilityAccount')

    Foreach ($User in $AllUsers) {
        $UserName = $User.name

        # Don't mess with these accounts
        if ($DefaultAccounts -Contains $UserName) {
            Write-Output "Skipping default account: $UserName"
            continue
        } 

        # Check if user should be admin
        if ($AdminsList -Contains $UserName) {
            Add-LocalGroupMember -Group "Administrators" -Member $UserName

            Write-Host -NoNewline "+ Admin has been given to: ${UserName}`r`n"
        }
        else {
            Remove-LocalGroupMember -Group "Administrators" -Member $UserName

            Write-Host -NoNewline "- Admin has been revoked from: ${UserName}`r`n"
        }

    }
}


function Remove-ForbiddenUsers {
    $Response = (Read-Host "Enter which accounts should exist on the system. Example: account1,account2")
    $ValidUsers = $Response.Split(",")

    $AllUsers = Get-LocalUser

    # Don't mess with these accounts
    $DefaultAccounts = @('Administrator', 'DefaultAccount', 'Guest', 'WDAGUtilityAccount')

    Foreach ($User in $AllUsers) {
        $UserName = $User.name

        # Don't mess with these accounts
        if ($DefaultAccounts -Contains $UserName) {
            Write-Output "Skipping default account: $UserName"
            continue
        } 

        # Check if account should exist on the system
        if ($ValidUsers -NotContains $UserName) {
            Remove-LocalUser -Name $UserName

            Write-Host -NoNewline "- User has been deleted: ${UserName}`r`n"
        }

    }
}

function Set-AccountPasswords {
    $Response = (Read-Host "Enter which passwords accounts should have. Example: account1;password1,account2;password2")
    $UsersToChange = $Response.Split(",")

    Foreach ($ChangeData in $UsersToChange) {
        # Parse name and password
        $SplitChangedData = $ChangeData.Split(";")

        $UserToChange = $SplitChangedData[0]
        $PasswordToChange = $SplitChangedData[1]

        $SecurePassword = ConvertTo-SecureString -AsPlainText -Force -String $PasswordToChange

        Set-LocalUser -Name $UserToChange -Password $SecurePassword

        Write-Host -NoNewline "+ User named `"${UserToChange}`" has been given the password: `"${PasswordToChange}`"`r`n"

    }
}

function Install-Antimalware {
    $RootPath = "$(Split-Path $PSScriptRoot -Parent)\software"

    # Download MalwareBytes
    $MBPath = "$RootPath\MalwareBytes_Setup.exe"

    if (!(Test-Path -Path $MBPath)) {
        Write-Output "Downloading MalwareBytes..."
        Invoke-WebRequest -Uri "https://www.malwarebytes.com/api/downloads/mb-windows?filename=MBSetup.exe" -OutFile $MBPath
    }
    else {
        Write-Output "MalwareBytes is already downloaded"
    }

    # Download AdwCleaner
    $AdwCPath = "$RootPath\AdwCleaner_Setup.exe"

    if (!(Test-Path -Path $AdwCPath)) {
        Write-Output "Downloading AdwCleaner..."
        Invoke-WebRequest -Uri "https://adwcleaner.malwarebytes.com/adwcleaner?channel=release" -OutFile $AdwCPath
    }
    else {
        Write-Output "AdwCleaner is already downloaded"
    }

    Write-Output ""

    # Run MalwareBytes
    Write-Output "Starting MalwareBytes..."
    Start-Process -NoNewWindow -FilePath $MBPath -ArgumentList "/VERYSILENT", "/NORESTART"

    # Run AdwCleaner
    Write-Output "Starting AdwCleaner..."
    Start-Process -NoNewWindow -FilePath $AdwcPath -ArgumentList "/eula", "/clean", "/noreboot", "/preinstalled"
}

function Search-ForFiles {
    $Extensions = "*.jpg", "*.jpeg", "*.png", "*.tiff", "*.bmp", "*.gif", "*.mp3", "*.wav", "*.ogg", "*.flac", "*.mp4", "*.mov", "*.mkv", "*.txt", "*.docx", "*.doc", "*.xlsx", "*.csv", "*.pptx", "*.psd", "*.pdf", "*.zip", "*.rar", "*.7z", "*.exe", "*.scr", "*.com", "*.msi", "*.bat"
    $SearchPath = "C:\Users"

    Get-ChildItem -Path $SearchPath -Include $Extensions -Recurse -ErrorAction SilentlyContinue -Force
}

# check out: https://admx.help/?Category=LAPS
function SecureSystem {
    # Set password expiry to 90 days
    net accounts /maxpwage:90

    # Set lockout duration to 30 minutes
    net accounts /lockoutduration:30

    # Set lockout threshold to 10 logon attempts
    net accounts /lockoutthreshold:10

    # Set logon attempt counter reset minutes to 10
    net accounts /lockoutwindow:10

    # Set minimum password length to 10
    net accounts /minpwlen:10

    # Set remembered password history to 10
    net accounts /uniquepw:10

    # Disable unwanted accounts
    Disable-LocalUser -Name "Guest"
    Disable-LocalUser -Name "Administrator"

    # Apply registry keys
    # General keys
    Set-ItemProperty -Path "HKLM\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate\AU" AutoInstallMinorUpdates -Type DWORD -Value 1 -Force
    Set-ItemProperty -Path "HKLM\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate\AU" NoAutoUpdate -Type DWORD -Value 0 -Force
    Set-ItemProperty -Path "HKLM\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate\AU" AUOptions -Type DWORD -Value 4 -Force
    Set-ItemProperty -Path "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\WindowsUpdate\Auto Update" AUOptions -Type DWORD -Value 4 -Force
    Set-ItemProperty -Path "HKLM\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate" DisableWindowsUpdateAccess -Type DWORD -Value 0 -Force
    Set-ItemProperty -Path "HKLM\SOFTWARE\Policies\Microsoft\Windows\WindowsUpdate" ElevateNonAdmins -Type DWORD -Value 0 -Force
    Set-ItemProperty -Path "HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\Explorer" NoWindowsUpdate -Type DWORD -Value 0 -Force
    Set-ItemProperty -Path "HKLM\SYSTEM\Internet Communication Management\Internet Communication" DisableWindowsUpdateAccess -Type DWORD -Value 0 -Force
    Set-ItemProperty -Path "HKCU\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\WindowsUpdate" DisableWindowsUpdateAccess -Type DWORD -Value 0 -Force
    # Restrict CD ROM drive
    Set-ItemProperty -Path "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon" AllocateCDRoms -Type DWORD -Value 1 -Force
    # Disallow remote access to floppy disks
    Set-ItemProperty -Path "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon" AllocateFloppies -Type DWORD -Value 1 -Force
    # Disable auto Admin logon
    Set-ItemProperty -Path "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Winlogon" AutoAdminLogon -Type DWORD -Value 0 -Force
    # Clear page file, will take longer to shutdown
    Set-ItemProperty -Path "HKLM\SYSTEM\CurrentControlSet\Control\Session Manager\Memory Management" ClearPageFileAtShutdown -Type DWORD -Value 1 -Force
    # Prevent users from installing printer drivers 
    Set-ItemProperty -Path "HKLM\SYSTEM\CurrentControlSet\Control\Print\Providers\LanMan Print Services\Servers" AddPrinterDrivers -Type DWORD -Value 1 -Force
    # Add auditing to Lsass.exe
    Set-ItemProperty -Path "HKLM\SOFTWARE\Microsoft\Windows NT\CurrentVersion\Image File Execution Options\LSASS.exe" AuditLevel -Type DWORD -Value 00000008 -Force
    # Enable LSA protection
    Set-ItemProperty -Path "HKLM\SYSTEM\CurrentControlSet\Control\Lsa" RunAsPPL -Type DWORD -Value 00000001 -Force
    # Limit use of blank passwords
    Set-ItemProperty -Path "HKLM\SYSTEM\CurrentControlSet\Control\Lsa" LimitBlankPasswordUse -Type DWORD -Value 1 -Force
    # Auditing access of Global System Objects
    Set-ItemProperty -Path "HKLM\SYSTEM\CurrentControlSet\Control\Lsa" auditbaseobjects -Type DWORD -Value 1 -Force
    # Auditing Backup and Restore
    Set-ItemProperty -Path "HKLM\SYSTEM\CurrentControlSet\Control\Lsa" fullprivilegeauditing -Type DWORD -Value 1 -Force
    # Restrict Anonymous Enumeration #1
    Set-ItemProperty -Path "HKLM\SYSTEM\CurrentControlSet\Control\Lsa" restrictanonymous -Type DWORD -Value 1 -Force
    # Restrict Anonymous Enumeration #2
    Set-ItemProperty -Path "HKLM\SYSTEM\CurrentControlSet\Control\Lsa" restrictanonymoussam -Type DWORD -Value 1 -Force
    # Disable storage of domain passwords
    Set-ItemProperty -Path "HKLM\SYSTEM\CurrentControlSet\Control\Lsa" disabledomaincreds -Type DWORD -Value 1 -Force
    # Take away Anonymous user Everyone permissions
    Set-ItemProperty -Path "HKLM\SYSTEM\CurrentControlSet\Control\Lsa" everyoneincludesanonymous -Type DWORD -Value 0 -Force
    # Allow Machine ID for NTLM
    Set-ItemProperty -Path "HKLM\SYSTEM\CurrentControlSet\Control\Lsa" UseMachineId -Type DWORD -Value 0 -Force
    # Do not display last user on logon
    Set-ItemProperty -Path "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" dontdisplaylastusername -Type DWORD -Value 1 -Force
    # Enable UAC
    # UAC setting, prompt on Secure Desktop
    Set-ItemProperty -Path "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" PromptOnSecureDesktop -Type DWORD -Value 1 -Force
    # Enable Installer Detection
    Set-ItemProperty -Path "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" EnableInstallerDetection -Type DWORD -Value 1 -Force
    # Disable undocking without logon
    Set-ItemProperty -Path "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" undockwithoutlogon -Type DWORD -Value 0 -Force
    # Enable CTRL+ALT+DEL
    Set-ItemProperty -Path "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" DisableCAD -Type DWORD -Value 0 -Force
    # Max password age
    Set-ItemProperty -Path "HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Policies\System" EnableLUA -Type DWORD -Value 1 -Force
    Set-ItemProperty -Path "HKLM\SYSTEM\CurrentControlSet\services\Netlogon\Parameters" MaximumPasswordAge -Type DWORD -Value 15 -Force
    # Disable machine account password changes
    Set-ItemProperty -Path "HKLM\SYSTEM\CurrentControlSet\services\Netlogon\Parameters" DisablePasswordChange -Type DWORD -Value 1 -Force
    # Require strong session key
    Set-ItemProperty -Path "HKLM\SYSTEM\CurrentControlSet\services\Netlogon\Parameters" RequireStrongKey -Type DWORD -Value 1 -Force
    # Require Sign/Seal
    Set-ItemProperty -Path "HKLM\SYSTEM\CurrentControlSet\services\Netlogon\Parameters" RequireSignOrSeal -Type DWORD -Value 1 -Force
    # Sign Channel
    Set-ItemProperty -Path "HKLM\SYSTEM\CurrentControlSet\services\Netlogon\Parameters" SignSecureChannel -Type DWORD -Value 1 -Force
    # Seal Channel
    Set-ItemProperty -Path "HKLM\SYSTEM\CurrentControlSet\services\Netlogon\Parameters" SealSecureChannel -Type DWORD -Value 1 -Force
    # Set idle time to 45 minutes
    Set-ItemProperty -Path "HKLM\SYSTEM\CurrentControlSet\services\LanmanServer\Parameters" autodisconnect -Type DWORD -Value 45 -Force
    # Require Security Signature - Disabled pursuant to checklist
    Set-ItemProperty -Path "HKLM\SYSTEM\CurrentControlSet\services\LanmanServer\Parameters" enablesecuritysignature -Type DWORD -Value 0 -Force
    # Enable Security Signature - Disabled pursuant to checklist
    Set-ItemProperty -Path "HKLM\SYSTEM\CurrentControlSet\services\LanmanServer\Parameters" requiresecuritysignature -Type DWORD -Value 0 -Force
    # Clear null session pipes
    Set-ItemProperty -Path "HKLM\SYSTEM\CurrentControlSet\services\LanmanServer\Parameters" NullSessionPipes /t REG_MULTI_SZ -Value "" -Force
    # Restict Anonymous user access to named pipes and shares
    Set-ItemProperty -Path "HKLM\SYSTEM\CurrentControlSet\services\LanmanServer\Parameters" NullSessionShares /t REG_MULTI_SZ -Value "" -Force
    # Encrypt SMB Passwords
    Set-ItemProperty -Path "HKLM\SYSTEM\CurrentControlSet\services\LanmanWorkstation\Parameters" EnablePlainTextPassword -Type DWORD -Value 0 -Force
    # Clear remote registry paths
    Set-ItemProperty -Path "HKLM\SYSTEM\CurrentControlSet\Control\SecurePipeServers\winreg\AllowedExactPaths" Machine /t REG_MULTI_SZ -Value "" -Force
    # Clear remote registry paths and sub-paths
    Set-ItemProperty -Path "HKLM\SYSTEM\CurrentControlSet\Control\SecurePipeServers\winreg\AllowedPaths" Machine /t REG_MULTI_SZ -Value "" -Force
    # Enable smart screen for IE8
    Set-ItemProperty -Path "HKCU\Software\Microsoft\Internet Explorer\PhishingFilter" EnabledV8 -Type DWORD -Value 1 -Force
    # Enable smart screen for IE9 and up
    Set-ItemProperty -Path "HKCU\Software\Microsoft\Internet Explorer\PhishingFilter" EnabledV9 -Type DWORD -Value 1 -Force
    # Disable IE password caching
    Set-ItemProperty -Path "HKCU\Software\Microsoft\Windows\CurrentVersion\Internet Settings" DisablePasswordCaching -Type DWORD -Value 1 -Force
    # Warn users if website has a bad certificate
    Set-ItemProperty -Path "HKCU\Software\Microsoft\Windows\CurrentVersion\Internet Settings" WarnonBadCertRecving -Type DWORD -Value 1 -Force
    # Warn users if website redirects
    Set-ItemProperty -Path "HKCU\Software\Microsoft\Windows\CurrentVersion\Internet Settings" WarnOnPostRedirect -Type DWORD -Value 1 -Force
    # Enable Do Not Track
    Set-ItemProperty -Path "HKCU\Software\Microsoft\Internet Explorer\Main" DoNotTrack -Type DWORD -Value 1 -Force
    Set-ItemProperty -Path "HKCU\Software\Microsoft\Internet Explorer\Download" RunInvalidSignatures -Type DWORD -Value 1 -Force
    Set-ItemProperty -Path "HKCU\Software\Microsoft\Internet Explorer\Main\FeatureControl\FEATURE_LOCALMACHINE_LOCKDOWN\Settings" LOCALMACHINE_CD_UNLOCK -Type DWORD -Value 1 -Force
    Set-ItemProperty -Path "HKCU\Software\Microsoft\Windows\CurrentVersion\Internet Settings" WarnonZoneCrossing -Type DWORD -Value 1 -Force
    # Show hidden files
    Set-ItemProperty -Path "HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced" Hidden -Type DWORD -Value 1 -Force
    # Disable sticky keys
    Set-ItemProperty -Path "HKU\.DEFAULT\Control Panel\Accessibility\StickyKeys" Flags /t REG_SZ -Value 506 -Force
    # Show super hidden files
    Set-ItemProperty -Path "HKCU\Software\Microsoft\Windows\CurrentVersion\Explorer\Advanced" ShowSuperHidden -Type DWORD -Value 1 -Force
    # Disable dump file creation
    Set-ItemProperty -Path "HKLM\SYSTEM\CurrentControlSet\Control\CrashControl" CrashDumpEnabled -Type DWORD -Value 0 -Force
    # Disable autoruns
    Set-ItemProperty -Path "HKCU\SYSTEM\CurrentControlSet\Services\CDROM" AutoRun -Type DWORD -Value 1 -Force

    # Enable windows update services
    Set-Service -Name "wuauserv" -StartupType Automatic
    Set-Service -Name "bits" -StartupType Automatic
    Set-Service -Name "cryptsvc" -StartupType Automatic
    Set-Service -Name "trustedinstaller" -StartupType Automatic

    # Start windows update services
    Start-Service -Name "wuauserv"
    Start-Service -Name "bits"
    Start-Service -Name "cryptsvc"
    Start-Service -Name "trustedinstaller"

    # Stop and disable microsoft ftp service
    Set-Service -Name "msftpsvc" -StartupType Disabled
    Stop-Service -Name "msftpsvc"

    # Enable Windows Defender Firewall with Advanced Security
    Set-NetFirewallProfile -Profile Domain, Public, Private -Enabled True

    # Enable Windows Defender entirely (https://support.huntress.io/hc/en-us/articles/4402989131283-Enabling-Microsoft-Defender-using-Powershell-)
    Set-MpPreference -DisableRealtimeMonitoring $false
    Set-MpPreference -DisableIOAVProtection $false
    New-Item -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows Defender" -Name "Real-Time Protection" -Force
    New-ItemProperty -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows Defender\Real-Time Protection" -Name "DisableBehaviorMonitoring" -Value 0 -PropertyType DWORD -Force
    New-ItemProperty -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows Defender\Real-Time Protection" -Name "DisableOnAccessProtection" -Value 0 -PropertyType DWORD -Force
    New-ItemProperty -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows Defender\Real-Time Protection" -Name "DisableScanOnRealtimeEnable" -Value 0 -PropertyType DWORD -Force
    New-ItemProperty -Path "HKLM:\SOFTWARE\Policies\Microsoft\Windows Defender" -Name "DisableAntiSpyware" -Value 0 -PropertyType DWORD -Force
    Start-Service -Name "WinDefend"
    Start-Service -Name "WdNisSvc"
}

function Show-FileShares {
    $Filter = "Type = 0 And Description != 'Default Share' And Name != 'ADMIN$' And Name != 'IPC$'"

    Write-Output "Listing non-standard file shares:"
    Write-Output "(This may take a few seconds)"
    Write-Output ""

    Get-CimInstance Win32_Share -Filter $Filter

    timeout 5 -Nobreak | Out-Null
}
